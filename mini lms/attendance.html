<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Attendance - Mini LMS</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  /* Reset and Base Styles */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  body {
    background: linear-gradient(135deg, #f8fafc 0%, #e9ecef 100%);
    color: #333;
    line-height: 1.6;
    min-height: 100vh;
  }

  /* Top Bar */
  .top-bar {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    color: white;
    padding: 1.2rem 2rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    position: sticky;
    top: 0;
    z-index: 100;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .top-bar h1 {
    font-family: 'Poppins', sans-serif;
    font-size: 1.8rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .top-bar h1 i {
    color: #6a11cb;
  }

  .user-info {
    display: flex;
    align-items: center;
    gap: 1rem;
    background: rgba(255, 255, 255, 0.1);
    padding: 0.5rem 1.2rem;
    border-radius: 50px;
    backdrop-filter: blur(10px);
  }

  .user-info img {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 2px solid rgba(106, 17, 203, 0.3);
  }

  /* Container */
  .container {
    max-width: 1400px;
    margin: 2rem auto;
    padding: 0 2rem;
  }

  /* Page Header */
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2.5rem;
    padding: 1.5rem 0;
    border-bottom: 1px solid #e2e8f0;
  }

  .page-header h2 {
    font-family: 'Poppins', sans-serif;
    font-size: 2.2rem;
    font-weight: 700;
    color: #1a1a2e;
    position: relative;
    padding-bottom: 0.5rem;
  }

  .page-header h2::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 60px;
    height: 4px;
    background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
    border-radius: 2px;
  }

  /* Summary Cards */
  .attendance-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
  }

  .summary-card {
    background: white;
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    overflow: hidden;
    border-top: 4px solid transparent;
  }

  .summary-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
  }

  .summary-card:nth-child(1) {
    border-top-color: #6a11cb;
  }

  .summary-card:nth-child(2) {
    border-top-color: #2ecc71;
  }

  .summary-card:nth-child(3) {
    border-top-color: #f39c12;
  }

  .summary-card h3 {
    font-size: 1rem;
    color: #64748b;
    font-weight: 600;
    margin-bottom: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .summary-card .value {
    font-size: 2.8rem;
    font-weight: 800;
    color: #1a1a2e;
    margin-bottom: 1.5rem;
    line-height: 1;
  }

  .summary-card .value::after {
    content: '';
    display: block;
    width: 40px;
    height: 4px;
    background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
    border-radius: 2px;
    margin-top: 0.5rem;
  }

  .summary-card:nth-child(2) .value::after {
    background: linear-gradient(90deg, #2ecc71 0%, #1abc9c 100%);
  }

  .summary-card:nth-child(3) .value::after {
    background: linear-gradient(90deg, #f39c12 0%, #e67e22 100%);
  }

  /* Progress Bar */
  .progress-bar {
    height: 8px;
    background-color: #e2e8f0;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 1rem;
  }

  .progress-fill {
    height: 100%;
    border-radius: 4px;
    background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
    transition: width 1.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    overflow: hidden;
  }

  .progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, 
      rgba(255, 255, 255, 0.1) 0%, 
      rgba(255, 255, 255, 0.3) 50%, 
      rgba(255, 255, 255, 0.1) 100%);
    animation: shimmer 2s infinite;
  }

  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  /* Table Container */
  .table-container {
    background: white;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
    overflow: hidden;
    margin-bottom: 3rem;
  }

  /* Table Styling */
  table {
    width: 100%;
    border-collapse: collapse;
  }

  thead {
    background: linear-gradient(135deg, #f8fafc 0%, #edf2f7 100%);
  }

  th {
    padding: 1.5rem;
    text-align: left;
    font-weight: 600;
    color: #475569;
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 2px solid #e2e8f0;
  }

  th:first-child {
    padding-left: 2.5rem;
  }

  th:last-child {
    padding-right: 2.5rem;
  }

  tbody tr {
    transition: all 0.3s ease;
    border-bottom: 1px solid #f1f5f9;
  }

  tbody tr:last-child {
    border-bottom: none;
  }

  tbody tr:hover {
    background: #f8fafc;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
  }

  td {
    padding: 1.5rem;
    color: #475569;
  }

  td:first-child {
    padding-left: 2.5rem;
    font-weight: 600;
    color: #1a1a2e;
  }

  td:last-child {
    padding-right: 2.5rem;
  }

  /* Course Cell */
  .course-title {
    display: flex;
    align-items: center;
    gap: 1rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .course-title:hover {
    color: #6a11cb;
    transform: translateX(5px);
  }

  .course-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.1rem;
  }

  /* Dynamic course icon colors based on course */
  td:first-child .course-title[data-course-id="1"] .course-icon {
    background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
  }

  td:first-child .course-title[data-course-id="2"] .course-icon {
    background: linear-gradient(135deg, #2ecc71 0%, #1abc9c 100%);
  }

  td:first-child .course-title[data-course-id="3"] .course-icon {
    background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
  }

  td:first-child .course-title[data-course-id="4"] .course-icon {
    background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
  }

  td:first-child .course-title[data-course-id="5"] .course-icon {
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
  }

  /* Percentage Cell */
  .percentage-cell {
    font-weight: 700;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .percentage-cell.high {
    color: #2ecc71;
  }

  .percentage-cell.medium {
    color: #f39c12;
  }

  .percentage-cell.low {
    color: #e74c3c;
  }

  .percentage-badge {
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    background: rgba(46, 204, 113, 0.1);
    color: #2ecc71;
  }

  .percentage-cell.high .percentage-badge {
    background: rgba(46, 204, 113, 0.1);
    color: #2ecc71;
  }

  .percentage-cell.medium .percentage-badge {
    background: rgba(243, 156, 18, 0.1);
    color: #f39c12;
  }

  .percentage-cell.low .percentage-badge {
    background: rgba(231, 76, 60, 0.1);
    color: #e74c3c;
  }

  /* Progress Indicator */
  .progress-indicator {
    width: 100px;
    height: 6px;
    background: #e2e8f0;
    border-radius: 3px;
    overflow: hidden;
    margin-top: 0.5rem;
  }

  .progress-indicator-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 1s ease;
  }

  /* Back Button */
  .back-btn {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    color: white;
    border: none;
    padding: 1rem 2rem;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    margin: 0 auto;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .back-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.7s;
  }

  .back-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
  }

  .back-btn:hover::before {
    left: 100%;
  }

  /* Modal Overlay */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 1rem;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  /* Modal Content */
  .modal-content {
    background: white;
    border-radius: 20px;
    padding: 2.5rem;
    max-width: 500px;
    width: 100%;
    box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
    animation: modalSlideIn 0.3s ease;
  }

  @keyframes modalSlideIn {
    from { opacity: 0; transform: translateY(-20px) scale(0.95); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }

  .modal-content h3 {
    font-family: 'Poppins', sans-serif;
    font-size: 1.5rem;
    color: #1a1a2e;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #6a11cb;
  }

  /* Modal Close Button */
  .modal-close-btn {
    background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
    color: white;
    border: none;
    padding: 0.9rem 1.8rem;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    margin-top: 1.5rem;
    transition: all 0.3s ease;
  }

  .modal-close-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(106, 17, 203, 0.3);
  }

  /* Notification */
  .notification {
    position: fixed;
    top: 1rem;
    right: 1rem;
    background: white;
    color: #1a1a2e;
    padding: 1.2rem 1.8rem;
    border-radius: 12px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
    z-index: 1001;
    display: flex;
    align-items: center;
    gap: 1rem;
    border-left: 4px solid #6a11cb;
    animation: slideInRight 0.5s ease;
    max-width: 400px;
  }

  @keyframes slideInRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }

  .notification.success {
    border-left-color: #2ecc71;
  }

  .notification.warning {
    border-left-color: #f39c12;
  }

  .notification.error {
    border-left-color: #e74c3c;
  }

  .notification.info {
    border-left-color: #3498db;
  }

  /* Animation for table rows */
  @keyframes fadeInRow {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  tbody tr {
    animation: fadeInRow 0.5s ease forwards;
  }

  tbody tr:nth-child(1) { animation-delay: 0.1s; }
  tbody tr:nth-child(2) { animation-delay: 0.2s; }
  tbody tr:nth-child(3) { animation-delay: 0.3s; }
  tbody tr:nth-child(4) { animation-delay: 0.4s; }
  tbody tr:nth-child(5) { animation-delay: 0.5s; }

  /* Responsive Design */
  @media (max-width: 1024px) {
    .attendance-summary {
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }
    
    .table-container {
      overflow-x: auto;
    }
    
    table {
      min-width: 900px;
    }
  }

  @media (max-width: 768px) {
    .container {
      padding: 0 1rem;
    }
    
    .top-bar {
      flex-direction: column;
      gap: 1rem;
      padding: 1rem;
    }
    
    .user-info {
      align-self: stretch;
      justify-content: center;
    }
    
    .page-header h2 {
      font-size: 1.8rem;
    }
    
    .summary-card {
      padding: 1.5rem;
    }
    
    .summary-card .value {
      font-size: 2.2rem;
    }
    
    .modal-content {
      padding: 1.5rem;
    }
    
    .notification {
      left: 1rem;
      right: 1rem;
      max-width: none;
    }
  }

  @media (max-width: 480px) {
    .attendance-summary {
      grid-template-columns: 1fr;
    }
    
    .percentage-cell {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }
    
    .back-btn {
      width: 100%;
      padding: 1.2rem;
    }
  }
</style>
</head>

<body>

<div class="top-bar">
  <h1><i class="fas fa-calendar-check"></i> Attendance Record</h1>
  <div class="user-info">
    <img src="https://ui-avatars.com/api/?name=John+Doe&background=6a11cb&color=fff" alt="Student">
    <span>John Doe | ID: 14656</span>
  </div>
</div>

<div class="container">
  <!-- Page Header -->
  <div class="page-header">
    <h2>Course-wise Attendance</h2>
  </div>
  
  <!-- Summary Cards -->
  <div class="attendance-summary">
    <div class="summary-card">
      <h3>Total Courses</h3>
      <div class="value" id="total-courses">5</div>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 100%"></div>
      </div>
    </div>
    <div class="summary-card">
      <h3>Overall Attendance</h3>
      <div class="value" id="overall-percentage">87.8%</div>
      <div class="progress-bar">
        <div class="progress-fill" id="overall-progress" style="width: 87.8%"></div>
      </div>
    </div>
    <div class="summary-card">
      <h3>Best Attendance</h3>
      <div class="value" id="best-percentage">94%</div>
      <div id="best-course">Database Systems</div>
    </div>
  </div>

  <!-- Table Container -->
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Course</th>
          <th>Total Classes</th>
          <th>Present</th>
          <th>Absent</th>
          <th>Percentage</th>
        </tr>
      </thead>
      <tbody id="attendance-table-body">
        <!-- Table rows will be populated by JavaScript -->
      </tbody>
    </table>
  </div>

  <button class="back-btn" id="back-to-dashboard">
    <i class="fas fa-arrow-left"></i> Back to Dashboard
  </button>

</div>

<!-- JavaScript remains EXACTLY as provided -->
<script>
  // Attendance data
 // Enhanced Attendance Data with more details
const attendanceData = [
  { 
    id: 1, 
    course: "Programming", 
    code: "CS101",
    instructor: "Dr. Smith",
    totalClasses: 30, 
    present: 27, 
    absent: 3, 
    percentage: 90,
    lastUpdated: "2024-03-15",
    attendanceHistory: [1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1]
  },
  { 
    id: 2, 
    course: "Data Structures", 
    code: "CS201",
    instructor: "Prof. Johnson",
    totalClasses: 28, 
    present: 24, 
    absent: 4, 
    percentage: 85,
    lastUpdated: "2024-03-14",
    attendanceHistory: [1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1]
  },
  { 
    id: 3, 
    course: "Communication Skills", 
    code: "CS301",
    instructor: "Dr. Williams",
    totalClasses: 25, 
    present: 22, 
    absent: 3, 
    percentage: 88,
    lastUpdated: "2024-03-13",
    attendanceHistory: [1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1]
  },
  { 
    id: 4, 
    course: "Database Systems", 
    code: "CS401",
    instructor: "Prof. Brown",
    totalClasses: 32, 
    present: 30, 
    absent: 2, 
    percentage: 94,
    lastUpdated: "2024-03-16",
    attendanceHistory: [1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1]
  },
  { 
    id: 5, 
    course: "Web Development", 
    code: "CS501",
    instructor: "Dr. Davis",
    totalClasses: 26, 
    present: 20, 
    absent: 6, 
    percentage: 77,
    lastUpdated: "2024-03-12",
    attendanceHistory: [1,0,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,0,1,1,1,1,0,1,1,1]
  }
];

// DOM Elements
const backBtn = document.getElementById('back-to-dashboard');
const tableBody = document.getElementById('attendance-table-body');
const totalCoursesEl = document.getElementById('total-courses');
const overallPercentageEl = document.getElementById('overall-percentage');
const overallProgressEl = document.getElementById('overall-progress');
const bestPercentageEl = document.getElementById('best-percentage');
const bestCourseEl = document.getElementById('best-course');

// Get percentage class based on value
function getPercentageClass(percentage) {
  if (percentage >= 90) return 'high';
  if (percentage >= 80) return 'medium';
  return 'low';
}

// Get attendance status text
function getAttendanceStatus(percentage) {
  if (percentage >= 90) return 'Excellent';
  if (percentage >= 85) return 'Very Good';
  if (percentage >= 80) return 'Good';
  if (percentage >= 75) return 'Satisfactory';
  return 'Needs Improvement';
}

// Format date
function formatDate(dateString) {
  const options = { year: 'numeric', month: 'short', day: 'numeric' };
  return new Date(dateString).toLocaleDateString('en-US', options);
}

// Calculate streak
function calculateStreak(attendanceHistory) {
  let currentStreak = 0;
  let maxStreak = 0;
  
  for (let i = attendanceHistory.length - 1; i >= 0; i--) {
    if (attendanceHistory[i] === 1) {
      currentStreak++;
      maxStreak = Math.max(maxStreak, currentStreak);
    } else {
      currentStreak = 0;
    }
  }
  
  return { current: currentStreak, max: maxStreak };
}

// Calculate statistics
function calculateStatistics() {
  const totalCourses = attendanceData.length;
  const totalClasses = attendanceData.reduce((sum, course) => sum + course.totalClasses, 0);
  const totalPresent = attendanceData.reduce((sum, course) => sum + course.present, 0);
  const overallPercentage = ((totalPresent / totalClasses) * 100).toFixed(1);
  
  let bestAttendance = 0;
  let bestCourse = '';
  
  attendanceData.forEach(course => {
    if (course.percentage > bestAttendance) {
      bestAttendance = course.percentage;
      bestCourse = course.course;
    }
  });
  
  return {
    totalCourses,
    totalClasses,
    totalPresent,
    overallPercentage,
    bestAttendance,
    bestCourse
  };
}

// Update summary cards
function updateSummaryCards() {
  const stats = calculateStatistics();
  
  totalCoursesEl.textContent = stats.totalCourses;
  overallPercentageEl.textContent = `${stats.overallPercentage}%`;
  overallProgressEl.style.width = `${stats.overallPercentage}%`;
  bestPercentageEl.textContent = `${stats.bestAttendance}%`;
  bestCourseEl.textContent = stats.bestCourse;
  
  animateProgressBars();
}

// Animate progress bars
function animateProgressBars() {
  const progressBars = document.querySelectorAll('.progress-fill');
  progressBars.forEach(bar => {
    const targetWidth = bar.style.width;
    bar.style.width = '0%';
    
    setTimeout(() => {
      bar.style.transition = 'width 1.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
      bar.style.width = targetWidth;
    }, 100);
  });
}

// Create and populate table rows
function populateTable() {
  tableBody.innerHTML = '';
  
  attendanceData.forEach((course, index) => {
    const row = document.createElement('tr');
    const percentageClass = getPercentageClass(course.percentage);
    const streak = calculateStreak(course.attendanceHistory);
    
    row.innerHTML = `
      <td>
        <div class="course-title" data-course-id="${course.id}" role="button" tabindex="0" aria-label="View details for ${course.course}">
          <div class="course-icon">
            <i class="fas fa-${course.id === 1 ? 'code' : course.id === 2 ? 'sitemap' : course.id === 3 ? 'comments' : course.id === 4 ? 'database' : 'laptop'}"></i>
          </div>
          <div>
            <strong>${course.course}</strong>
            <div style="font-size: 0.85rem; color: #64748b; margin-top: 2px;">${course.code}</div>
          </div>
        </div>
      </td>
      <td>${course.totalClasses}</td>
      <td>
        <span style="color: #2ecc71; font-weight: 600;">${course.present}</span>
        ${streak.current > 3 ? `<span style="display: block; font-size: 0.8rem; color: #f39c12;">ðŸ”¥ ${streak.current} days streak</span>` : ''}
      </td>
      <td>
        <span style="color: #e74c3c; font-weight: 600;">${course.absent}</span>
      </td>
      <td class="percentage-cell ${percentageClass}">
        <div style="display: flex; align-items: center; gap: 0.75rem;">
          <span style="font-size: 1.3rem; font-weight: 700;">${course.percentage}%</span>
          <span class="percentage-badge">
            ${getAttendanceStatus(course.percentage)}
          </span>
        </div>
        <div class="progress-indicator">
          <div class="progress-indicator-fill" style="width: ${course.percentage}%; background: ${percentageClass === 'high' ? '#2ecc71' : percentageClass === 'medium' ? '#f39c12' : '#e74c3c'}"></div>
        </div>
        <div style="font-size: 0.85rem; color: #94a3b8; margin-top: 4px;">
          Updated: ${formatDate(course.lastUpdated)}
        </div>
      </td>
    `;
    
    const courseTitle = row.querySelector('.course-title');
    courseTitle.addEventListener('click', () => showCourseModal(course));
    courseTitle.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        showCourseModal(course);
      }
    });
    
    tableBody.appendChild(row);
  });
}

// Create attendance history chart
function createAttendanceChart(course) {
  const history = course.attendanceHistory;
  const container = document.createElement('div');
  container.style.marginTop = '20px';
  
  const title = document.createElement('div');
  title.textContent = 'Recent Attendance Pattern:';
  title.style.color = '#475569';
  title.style.marginBottom = '10px';
  title.style.fontWeight = '600';
  
  const chart = document.createElement('div');
  chart.style.display = 'flex';
  chart.style.gap = '4px';
  chart.style.flexWrap = 'wrap';
  chart.style.marginBottom = '15px';
  
  // Show last 20 classes or all if less
  const showCount = Math.min(20, history.length);
  const startIndex = history.length - showCount;
  
  for (let i = startIndex; i < history.length; i++) {
    const day = document.createElement('div');
    day.style.width = '16px';
    day.style.height = '16px';
    day.style.borderRadius = '3px';
    day.style.backgroundColor = history[i] === 1 ? '#2ecc71' : '#e74c3c';
    day.style.position = 'relative';
    day.style.cursor = 'pointer';
    
    day.title = `Class ${i + 1}: ${history[i] === 1 ? 'Present' : 'Absent'}`;
    
    chart.appendChild(day);
  }
  
  const legend = document.createElement('div');
  legend.style.display = 'flex';
  legend.style.gap = '15px';
  legend.style.fontSize = '0.85rem';
  legend.style.color = '#64748b';
  
  legend.innerHTML = `
    <div style="display: flex; align-items: center; gap: 5px;">
      <div style="width: 12px; height: 12px; background-color: #2ecc71; border-radius: 2px;"></div>
      Present
    </div>
    <div style="display: flex; align-items: center; gap: 5px;">
      <div style="width: 12px; height: 12px; background-color: #e74c3c; border-radius: 2px;"></div>
      Absent
    </div>
  `;
  
  container.appendChild(title);
  container.appendChild(chart);
  container.appendChild(legend);
  
  return container;
}

// Create modal with scrollable content
function createScrollableModal(course) {
  const percentageClass = getPercentageClass(course.percentage);
  const percentageColor = course.percentage >= 90 ? '#2ecc71' : 
                        course.percentage >= 80 ? '#f39c12' : '#e74c3c';
  const streak = calculateStreak(course.attendanceHistory);
  
  const modal = document.createElement('div');
  modal.className = 'modal-overlay';
  modal.id = 'course-modal';
  modal.style.zIndex = '1000';
  modal.style.overflow = 'auto';
  
  modal.innerHTML = `
    <div class="modal-content" style="max-width: 700px; width: 95%; max-height: 85vh; overflow: hidden; position: relative;">
      <div style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
        <button id="modal-close-btn" style="background: #e74c3c; color: white; border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div style="max-height: calc(85vh - 5rem); overflow-y: auto; padding-right: 10px;">
        <h3 style="padding-right: 40px;">
          <i class="fas fa-chart-bar" style="color: ${percentageColor}; margin-right: 0.5rem;"></i>
          ${course.course} (${course.code}) - Attendance Details
        </h3>
        
        <div style="margin-bottom: 20px; color: #64748b; font-size: 0.95rem; padding-right: 40px;">
          Instructor: ${course.instructor} | Last Updated: ${formatDate(course.lastUpdated)}
        </div>
        
        <!-- Stats Grid -->
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
          <div style="background: #f8fafc; padding: 1rem; border-radius: 10px; text-align: center;">
            <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">Total Classes</div>
            <div style="font-size: 1.8rem; font-weight: 700; color: #1a1a2e;">${course.totalClasses}</div>
          </div>
          <div style="background: #f8fafc; padding: 1rem; border-radius: 10px; text-align: center;">
            <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">Present</div>
            <div style="font-size: 1.8rem; font-weight: 700; color: #2ecc71;">${course.present}</div>
          </div>
          <div style="background: #f8fafc; padding: 1rem; border-radius: 10px; text-align: center;">
            <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">Absent</div>
            <div style="font-size: 1.8rem; font-weight: 700; color: #e74c3c;">${course.absent}</div>
          </div>
          <div style="background: #f8fafc; padding: 1rem; border-radius: 10px; text-align: center;">
            <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">Percentage</div>
            <div style="font-size: 1.8rem; font-weight: 700; color: ${percentageColor};">${course.percentage}%</div>
          </div>
        </div>
        
        <!-- Streak Information -->
        <div style="display: flex; gap: 1rem; margin: 1.5rem 0;">
          <div style="flex: 1; background: #fff8e1; padding: 1rem; border-radius: 10px; border-left: 4px solid #f39c12;">
            <div style="font-size: 0.9rem; color: #f39c12; margin-bottom: 0.5rem;">Current Streak</div>
            <div style="font-size: 1.5rem; font-weight: 700; color: #1a1a2e;">${streak.current} days</div>
          </div>
          <div style="flex: 1; background: #e8f5e9; padding: 1rem; border-radius: 10px; border-left: 4px solid #2ecc71;">
            <div style="font-size: 0.9rem; color: #2ecc71; margin-bottom: 0.5rem;">Best Streak</div>
            <div style="font-size: 1.5rem; font-weight: 700; color: #1a1a2e;">${streak.max} days</div>
          </div>
        </div>
        
        <!-- Attendance Chart -->
        <div id="attendance-chart-container" style="margin: 1.5rem 0;"></div>
        
        <!-- Attendance Progress -->
        <div style="margin: 1.5rem 0;">
          <h4 style="color: #475569; margin-bottom: 15px; font-size: 1.1rem;">Attendance Progress</h4>
          <div class="progress-bar" style="height: 16px; margin-bottom: 10px; background: #e2e8f0;">
            <div class="progress-fill" style="width: ${course.percentage}%; background: linear-gradient(90deg, ${percentageColor} 0%, ${percentageColor}99 100%);"></div>
          </div>
          <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: #94a3b8;">
            <span>0%</span>
            <span>50%</span>
            <span style="color: #e74c3c;">75% (Min)</span>
            <span>100%</span>
          </div>
        </div>
        
        <!-- Remarks -->
        <div style="margin: 1.5rem 0;">
          <h4 style="color: #475569; margin-bottom: 15px; font-size: 1.1rem;">Remarks</h4>
          <div style="padding: 1.2rem; background: ${percentageClass === 'high' ? '#d5f4e630' : percentageClass === 'medium' ? '#f9e79f30' : '#fadbd830'}; 
             border-radius: 12px; border-left: 4px solid ${percentageClass === 'high' ? '#2ecc71' : percentageClass === 'medium' ? '#f39c12' : '#e74c3c'};">
            <p style="color: #475569; margin-bottom: 0.5rem; font-weight: 600;">
              ${getAttendanceStatus(course.percentage)}
            </p>
            <p style="color: #64748b; font-size: 0.95rem;">
              ${course.percentage >= 90 ? 'You have maintained outstanding attendance. Keep up the excellent work!' : 
                course.percentage >= 85 ? 'Very good attendance record. You are consistently attending classes.' : 
                course.percentage >= 80 ? 'Good attendance. Continue with this pattern to maintain your performance.' : 
                course.percentage >= 75 ? 'You are meeting the minimum requirement. Try to improve your attendance for better academic performance.' : 
                'Your attendance is below the required threshold. Please attend more classes regularly to avoid academic penalties.'}
            </p>
          </div>
        </div>
        
        <!-- Close Button at Bottom -->
        <button class="modal-close-btn" id="close-modal-bottom" style="margin: 1.5rem 0 0.5rem 0; width: 100%;">
          <i class="fas fa-times"></i> Close Details
        </button>
      </div>
    </div>
  `;
  
  return modal;
}

// Show course details modal (fixed scrollable version)
function showCourseModal(course) {
  // Remove any existing modal
  const existingModal = document.getElementById('course-modal');
  if (existingModal) {
    existingModal.remove();
  }
  
  // Prevent body scrolling when modal is open
  document.body.style.overflow = 'hidden';
  
  // Create scrollable modal
  const modal = createScrollableModal(course);
  document.body.appendChild(modal);
  
  // Add attendance chart
  const chartContainer = modal.querySelector('#attendance-chart-container');
  chartContainer.appendChild(createAttendanceChart(course));
  
  // Add event listeners
  const closeModal = () => {
    modal.style.animation = 'fadeOut 0.3s ease';
    setTimeout(() => {
      modal.remove();
      document.body.style.overflow = 'auto';
    }, 300);
  };
  
  // Close buttons
  const closeBtnTop = modal.querySelector('#modal-close-btn');
  const closeBtnBottom = modal.querySelector('#close-modal-bottom');
  
  closeBtnTop.addEventListener('click', closeModal);
  closeBtnBottom.addEventListener('click', closeModal);
  
  // Close on overlay click
  modal.addEventListener('click', (e) => {
    if (e.target === modal) closeModal();
  });
  
  // Close with Escape key
  const closeOnEscape = (e) => {
    if (e.key === 'Escape') {
      closeModal();
      document.removeEventListener('keydown', closeOnEscape);
    }
  };
  document.addEventListener('keydown', closeOnEscape);
  
  // Focus trap for accessibility
  const focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
  const firstFocusableElement = focusableElements[0];
  const lastFocusableElement = focusableElements[focusableElements.length - 1];
  
  modal.addEventListener('keydown', function(e) {
    if (e.key === 'Tab') {
      if (e.shiftKey) {
        if (document.activeElement === firstFocusableElement) {
          lastFocusableElement.focus();
          e.preventDefault();
        }
      } else {
        if (document.activeElement === lastFocusableElement) {
          firstFocusableElement.focus();
          e.preventDefault();
        }
      }
    }
  });
  
  // Focus first element
  setTimeout(() => firstFocusableElement?.focus(), 100);
}

// Show notification
function showNotification(message, type = 'success', duration = 3000) {
  const existingNotifications = document.querySelectorAll('.notification');
  existingNotifications.forEach(notification => {
    notification.style.animation = 'fadeOut 0.5s ease';
    setTimeout(() => notification.remove(), 500);
  });
  
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.innerHTML = `
    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : type === 'error' ? 'times-circle' : 'info-circle'}"></i>
    <span>${message}</span>
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.style.animation = 'fadeOut 0.5s ease';
    setTimeout(() => notification.remove(), 500);
  }, duration);
}

// Initialize the page
function init() {
  // Populate table and update summary
  populateTable();
  updateSummaryCards();
  
  // Back button functionality
  backBtn.addEventListener('click', function() {
    const originalText = this.innerHTML;
    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
    this.disabled = true;
    
    showNotification('Returning to Dashboard...', 'info');
    
    setTimeout(() => {
      this.innerHTML = originalText;
      this.disabled = false;
      showNotification('Dashboard navigation simulated. In a real app, this would redirect.', 'info');
    }, 1500);
  });
  
  // Add export button
  const exportBtn = document.createElement('button');
  exportBtn.className = 'back-btn';
  exportBtn.style.marginRight = '15px';
  exportBtn.innerHTML = '<i class="fas fa-file-export"></i> Export Report';
  exportBtn.addEventListener('click', () => {
    showNotification('Export feature would generate CSV report in real application.', 'info');
  });
  backBtn.parentNode.insertBefore(exportBtn, backBtn);
  
  // Keyboard navigation for table rows
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
      const activeElement = document.activeElement;
      if (activeElement.classList.contains('course-title')) {
        e.preventDefault();
        const rows = document.querySelectorAll('tbody tr .course-title');
        let currentIndex = -1;
        
        rows.forEach((row, index) => {
          if (row === activeElement) currentIndex = index;
        });
        
        if (e.key === 'ArrowDown' && currentIndex < rows.length - 1) {
          rows[currentIndex + 1].focus();
        } else if (e.key === 'ArrowUp' && currentIndex > 0) {
          rows[currentIndex - 1].focus();
        }
      }
    }
  });
  
  // Demo: Simulate attendance updates every 15 seconds
  setInterval(() => {
    const randomIndex = Math.floor(Math.random() * attendanceData.length);
    const course = attendanceData[randomIndex];
    const isPresent = Math.random() > 0.2;
    
    course.totalClasses += 1;
    if (isPresent) {
      course.present += 1;
      course.attendanceHistory.push(1);
    } else {
      course.absent += 1;
      course.attendanceHistory.push(0);
    }
    
    course.percentage = Math.round((course.present / course.totalClasses) * 100);
    course.lastUpdated = new Date().toISOString().split('T')[0];
    
    populateTable();
    updateSummaryCards();
    
    const status = isPresent ? 'present' : 'absent';
    showNotification(`${course.course} attendance updated! Marked as ${status} for today.`, 'info');
  }, 15000);
  
  // Show welcome message
  setTimeout(() => {
    const stats = calculateStatistics();
    showNotification(`Welcome! Your overall attendance is ${stats.overallPercentage}%. Click on any course for details.`, 'success', 4000);
  }, 1000);
  
  // Add keyboard shortcut hint
  setTimeout(() => {
    showNotification('ðŸ’¡ Tip: Use arrow keys to navigate between courses', 'info', 5000);
  }, 3000);
}

// Add fadeOut animation for notifications
const style = document.createElement('style');
style.textContent = `
  @keyframes fadeOut {
    from { opacity: 1; transform: translateX(0); }
    to { opacity: 0; transform: translateX(100%); }
  }
  
  .modal-content div[style*="max-height: calc(85vh - 5rem)"]::-webkit-scrollbar {
    width: 8px;
  }
  
  .modal-content div[style*="max-height: calc(85vh - 5rem)"]::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 4px;
  }
  
  .modal-content div[style*="max-height: calc(85vh - 5rem)"]::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 4px;
  }
  
  .modal-content div[style*="max-height: calc(85vh - 5rem)"]::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }
`;
document.head.appendChild(style);

// Initialize when page loads
document.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>